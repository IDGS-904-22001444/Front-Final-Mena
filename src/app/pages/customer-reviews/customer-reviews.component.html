<div class="min-h-screen bg-gray-50 py-8">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Header -->
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-gray-900">Reseñas de Productos</h1>
      <p class="mt-2 text-gray-600">Comparte tu experiencia con nuestros productos ReptiTrack</p>
    </div>

    <!-- Formulario para nueva reseña - solo visible si está logueado -->
    @if (authService.isLoggedIn()) {
      <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
        <h2 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
          <mat-icon class="mr-2 text-green-600">rate_review</mat-icon>
          Deja tu Reseña
        </h2>
      
      <form (ngSubmit)="submitReview()" class="space-y-6">
        <!-- Comentario -->
        <div>
          <label for="comment" class="block text-sm font-medium text-gray-700 mb-2">
            Comentario *
          </label>
          <textarea 
            id="comment"
            [(ngModel)]="comment" 
            name="comment" 
            rows="4" 
            required
            placeholder="Comparte tu experiencia con nuestros productos..."
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none"
          ></textarea>
        </div>

        <!-- Calificación -->
        <div>
          <label for="rating" class="block text-sm font-medium text-gray-700 mb-2">
            Calificación *
          </label>
          <div class="flex items-center space-x-4">
            <select 
              id="rating"
              [(ngModel)]="rating" 
              name="rating" 
              required
              class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
            >
              <option value="1">1 - Muy malo</option>
              <option value="2">2 - Malo</option>
              <option value="3">3 - Regular</option>
              <option value="4">4 - Bueno</option>
              <option value="5">5 - Excelente</option>
            </select>
            
            <!-- Vista previa de estrellas -->
            <div class="flex items-center">
              <mat-icon 
                *ngFor="let star of getRatingStars(rating)" 
                [class]="star === 'star' ? 'text-yellow-400' : 'text-gray-300'"
              >
                {{ star }}
              </mat-icon>
            </div>
          </div>
        </div>

        <!-- Botón enviar -->
        <div class="flex justify-end">
          <button 
            type="submit" 
            [disabled]="!comment.trim() || !rating || !clientId || isSubmitting"
            class="bg-green-600 hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-bold py-3 px-6 rounded-lg transition-colors duration-200 flex items-center"
          >
            <mat-icon class="mr-2" *ngIf="!isSubmitting">send</mat-icon>
            <mat-icon class="mr-2 animate-spin" *ngIf="isSubmitting">refresh</mat-icon>
            {{ isSubmitting ? 'Enviando...' : 'Enviar Reseña' }}
          </button>
        </div>
      </form>
    </div>
    } @else {
      <!-- Mensaje para usuarios no logueados -->
      <div class="bg-blue-50 border border-blue-200 rounded-xl p-6 mb-8">
        <div class="flex items-center">
          <mat-icon class="text-blue-600 mr-3">info</mat-icon>
          <div>
            <h3 class="text-lg font-semibold text-blue-800 mb-1">Inicia sesión para dejar una reseña</h3>
            <p class="text-blue-700">Para compartir tu experiencia con nuestros productos, necesitas iniciar sesión.</p>
            <a routerLink="/login" class="inline-block mt-3 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-200">
              Iniciar Sesión
            </a>
          </div>
        </div>
      </div>
    }

    <!-- Lista de reseñas existentes -->
    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
      <div class="px-6 py-4 bg-gradient-to-r from-green-600 to-green-700">
        <h2 class="text-xl font-bold text-white flex items-center">
          <mat-icon class="mr-2">reviews</mat-icon>
          Reseñas Recientes ({{ reviews.length }})
        </h2>
      </div>

      <div class="divide-y divide-gray-200">
        @if (reviews && reviews.length > 0) {
          @for (review of reviews; track review.id) {
            <div class="p-6">
              <!-- Header de la reseña -->
              <div class="flex items-start justify-between mb-3">
                <div class="flex items-center space-x-3">
                  <div class="bg-green-100 p-2 rounded-full">
                    <mat-icon class="text-green-600">person</mat-icon>
                  </div>
                  <div>
                    <!-- Mostrar nombre completo en lugar del ID -->
                    <p class="font-semibold text-gray-900">
                      {{ review.client?.fullName || 'Usuario Anónimo' }}
                    </p>
                    <p class="text-sm text-gray-500">
                      {{ review.createdAt | date:'medium' }}
                    </p>
                    
                  </div>
                </div>
                
                <!-- Rating stars -->
                <div class="flex items-center">
                  <mat-icon 
                    *ngFor="let star of getRatingStars(review.rating)" 
                    [class]="star === 'star' ? 'text-yellow-400' : 'text-gray-300'"
                    class="text-sm"
                  >
                    {{ star }}
                  </mat-icon>
                  <span class="ml-2 text-sm text-gray-600">({{ review.rating }}/5)</span>
                </div>
              </div>

              <!-- Comentario -->
              <div class="mb-4">
                <p class="text-gray-800 leading-relaxed">{{ review.comment }}</p>
              </div>

              <!-- Respuesta del admin (si existe) -->
              @if (review.reply) {
                <div class="bg-green-50 border-l-4 border-green-400 p-4 rounded-r-lg">
                  <div class="flex items-start">
                    <mat-icon class="text-green-600 mr-2 mt-0.5">support_agent</mat-icon>
                    <div class="flex-1">
                      <p class="font-semibold text-green-800 text-sm mb-1">Respuesta del Equipo ReptiTrack:</p>
                      <p class="text-green-700">{{ review.reply }}</p>
                      <p class="text-green-600 text-xs mt-2">
                        {{ review.repliedAt | date:'medium' }}
                      </p>
                    </div>
                  </div>
                </div>
              }
            </div>
          }
        } @else {
          <div class="p-12 text-center">
            <div class="bg-gray-100 rounded-full p-6 w-24 h-24 mx-auto mb-4 flex items-center justify-center">
              <mat-icon class="text-gray-400 text-4xl">rate_review</mat-icon>
            </div>
            <h3 class="text-lg font-medium text-gray-900 mb-2">No hay reseñas aún</h3>
            <p class="text-gray-500">¡Sé el primero en compartir tu experiencia!</p>
          </div>
        }
      </div>
    </div>
  </div>
</div>