<div class="overflow-x-auto">
  @if (sales && sales.length > 0) {
  <table class="min-w-full">
    <thead class="bg-gray-50 border-b border-gray-200">
      <tr>
        <th
          class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"
        >
          #ID
        </th>
        <th
          class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"
        >
          Producto
        </th>
        @if(isAdmin) {
        <th
          class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"
        >
          Cliente
        </th>
        }
        <th
          class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"
        >
          Cantidad
        </th>
        <th
          class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"
        >
          Fecha de Venta
        </th>
        <th
          class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"
        >
          Total
        </th>
        <th
          class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"
        >
          Estado
        </th>
        @if(isAdmin) {
        <th
          class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider"
        >
          Acciones
        </th>
        }
      </tr>
    </thead>
    <tbody class="divide-y divide-gray-200">
      @for (sale of sales; track trackBySaleId($index, sale)) {
      <tr
        class="hover:bg-gray-50 transition-colors cursor-pointer"
        (click)="onSelectSale(sale.id)"
      >
        <td class="px-6 py-4 whitespace-nowrap">
          <div class="flex items-center">
            <div
              class="bg-blue-100 text-blue-600 px-3 py-1 rounded-full text-sm font-medium"
            >
              #{{ sale.id }}
            </div>
          </div>
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <div class="flex items-center">
            <div class="bg-green-100 p-2 rounded-full mr-3">
              <mat-icon class="text-green-600 text-sm">inventory_2</mat-icon>
            </div>
            <div>
              <div class="text-sm font-medium text-gray-900">
                {{ sale.product?.name || "Producto #" + sale.productId }}
              </div>
              <div class="text-sm text-gray-500">
                {{ sale.product?.description || "Sin descripción" }}
              </div>
              <div class="text-xs text-gray-400">
                Precio unitario: {{ formatPrice(sale.product?.salePrice || 0) }}
              </div>
            </div>
          </div>
        </td>
        @if(isAdmin) {
        <td class="px-6 py-4 whitespace-nowrap">
          <div class="flex items-center">
            <div class="bg-purple-100 p-2 rounded-full mr-3">
              <mat-icon class="text-purple-600 text-sm">person</mat-icon>
            </div>
            <div>
              <div class="text-sm font-medium text-gray-900">
                {{ sale.client?.fullName || "Cliente sin nombre" }}
              </div>
              <div class="text-sm text-gray-500">
                {{ sale.client?.email || "Sin email" }}
              </div>
              <div class="text-xs text-gray-400">
                Usuario: {{ sale.client?.userName || "Sin usuario" }}
              </div>
            </div>
          </div>
        </td>
        }
        <td class="px-6 py-4 whitespace-nowrap">
          <div class="text-sm text-gray-900 font-medium">
            {{ sale.quantity }} unidades
          </div>
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <div class="text-sm text-gray-900">
            {{ formatDate(sale.saleDate) }}
          </div>
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <div class="text-lg font-bold text-gray-900">
            {{ formatPrice(sale.total) }}
          </div>
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <span
            class="inline-flex px-3 py-1 text-xs font-semibold rounded-full"
            [ngClass]="getStatusClass(sale.status)"
          >
            {{ getStatusText(sale.status) }}
          </span>
        </td>
        @if(isAdmin) {
        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
          <div class="flex space-x-3">
            <button
              type="button"
              (click)="edit(sale); $event.stopPropagation()"
              class="bg-blue-100 hover:bg-blue-200 text-blue-600 p-2 rounded-lg transition-colors flex items-center"
              title="Editar venta"
            >
              <mat-icon class="w-4 h-4">edit</mat-icon>
            </button>
            <button
              type="button"
              (click)="delete(sale.id); $event.stopPropagation()"
              class="bg-red-100 hover:bg-red-200 text-red-600 p-2 rounded-lg transition-colors flex items-center"
              title="Eliminar venta"
            >
              <mat-icon class="w-4 h-4">delete</mat-icon>
            </button>
          </div>
        </td>
        }
      </tr>
      <!-- Detalle expandido -->
      <tr *ngIf="selectedSaleId === sale.id && !showSaleDetail">
        <td colspan="8" class="bg-gray-50 px-6 py-4">
          <div class="flex flex-col md:flex-row gap-6">
            <div>
              <h4 class="font-bold text-lg mb-2">Detalle de la compra</h4>
              <p><strong>Producto:</strong> {{ sale.product?.name }}</p>
              <p>
                <strong>Descripción:</strong> {{ sale.product?.description }}
              </p>
              <p><strong>Cantidad:</strong> {{ sale.quantity }}</p>
              <p>
                <strong>Precio unitario:</strong>
                {{ formatPrice(sale.product?.salePrice || 0) }}
              </p>
              <p><strong>Total:</strong> {{ formatPrice(sale.total) }}</p>
              <p>
                <strong>Fecha de venta:</strong> {{ formatDate(sale.saleDate) }}
              </p>
              <p><strong>Estado:</strong> {{ getStatusText(sale.status) }}</p>
            </div>
            <!-- Puedes agregar más detalles aquí si lo necesitas -->
          </div>
        </td>
      </tr>
      }
    </tbody>
  </table>
  } @else {
  <div class="text-center py-16">
    <div
      class="bg-gray-100 rounded-full p-6 w-24 h-24 mx-auto mb-4 flex items-center justify-center"
    >
      <mat-icon class="text-gray-400 text-4xl">shopping_bag</mat-icon>
    </div>
    <h3 class="text-lg font-medium text-gray-900 mb-2">
      {{
        isAdmin ? "No hay ventas registradas" : "No tienes compras registradas"
      }}
    </h3>
    <p class="text-gray-500">
      {{
        isAdmin
          ? "Las ventas aparecerán aquí cuando se realicen."
          : "Tus compras aparecerán aquí cuando realices alguna."
      }}
    </p>
  </div>
  }
</div>
